#!/usr/bin/env ruby

# Dice rolling program
# by Brian Towle -- March 2012

$:.unshift File.join(File.dirname(__FILE__), '..', 'lib')
require 'dieroll'
require 'optparse'

usage_string = "Usage: roll [-c val] [-ct eq|gt|gte|lt|lte] [-r] <roll-string>"

options = {}
OptionParser.new do |opts|
  opts.banner = usage_string
  
  options[:results] = false
  opts.on('-r','--results','Show full roll results' ) do
    options[:results] = true
  end

  opts.on('-e','--equal VAL',
                'show chances of rolling given value') do |val|
    options[:equal] = true
    options[:val] = val.to_i
  end

  opts.on('-h','--help','Display this screen') do
    puts opts
    exit
  end

end.parse!

if(!!ARGV.first)
  dice = Dieroll::Roller.new(ARGV.first)
else
  abort(usage_string)
end

dice.roll!
if options[:results]
  puts dice.report
elsif options[:equal]
  puts dice.odds.equal options[:val]
else
  puts dice.total
end
